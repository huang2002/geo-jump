!function(){"use strict";function t(){return(t=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}var o=HE,e=o.Text,n=o.Vector,i=o.Rectangle,l=o.Utils,s=new HE.Renderer({width:320,height:480}),r=new HE.Engine({renderer:s}),a=s.bounds,c=HE.Category,f=s.context.createLinearGradient(0,a.top,0,a.bottom),d=c.for("player"),h=c.for("bomb"),u=c.for("shape");f.addColorStop(0,"#222"),f.addColorStop(1,"#111");for(var p=["#F0C","#F00","#F60","#FF0","#9F0","#090","#0F0","#0F9","#06F","#C0F"],y=function(){return l.pick(p)},w="en",C="zh",E={category:u,collisionFilter:d|h,radius:5,elasticity:.1,friction:.97,staticFriction:.98,fillFirst:!1,style:{lineWidth:4,shadowColor:"#002",shadowOffsetY:4}},m=[],S=0;S<3;S++)m.push(new i(E));var v,F,g=function(t){t.style.strokeStyle=y(),t.updateSize(l.random(90,130),l.random(60,150))},H=function(){return l.random(20,100)},O=function(t){var o=m[t];o.moveTo(m[t-1].bounds.right+o.width/2+l.random(15,70),o.height/2+H())},P=0,T=function(){return P},b=function(t){return P=Math.max(P,Math.round(.05*t))},k=new HE.Circle({category:d,active:!0,radius:20,elasticity:.1,friction:.97,staticFriction:.98,maxSpeed:80,fillFirst:!1,style:{strokeStyle:"#0CF",lineWidth:4,shadowColor:"#002",shadowOffsetY:4}}),I=new HE.Pool(HE.Particles,{count:20,life:1500,loop:!1,pool:new HE.Pool(i,{active:!0,width:8,height:8,gravity:n.of(0,.1),airFriction:.08,style:{strokeStyle:null}}),initializer:function(t){t.style.fillStyle=y(),t.position.reset(),t.velocity.setVector(n.random(),l.random(1,16))}}),x=new HE.Pool(HE.Transition,{from:1,to:0,duration:1500,timing:HE.Timing.easeIn}),R=function(t,o){var e=I.get(),n=x.get();e.offset.setVector(o),n.start();var i=function(t){e.items.forEach(function(o){o.style.opacity=t})};n.on("update",i).once("end",function(){t.remove(e).disuse(n),n.off("update",i),I.add(e),x.add(n)}),t.add(e).use(n)},A=new HE.Pool(HE.Rectangle,{active:!0,sensorFilter:u,category:h,collisionFilter:u,width:10,height:10,style:{strokeStyle:null,fillStyle:"#F30"}}),L=function(t,o,e){var i=A.get();i.moveToVector(o),i.velocity.setVector(e).setNorm(30).plusVector(k.velocity),i.on("collision",function(o){R(t,i.position),t.remove(i);var e=n.minus(k.position,i.position);k.velocity.plusVector(e.setNorm(Math.min(25,550/e.getNorm())))}).on("didUpdate",function(){i.bounds.top>a.bottom&&t.remove(i)}),t.add(i)},_="hi",N="lang",G=((v={})[_]=0,v[N]=w,v),Y=function(t){localStorage.setItem("geo-jump-store",JSON.stringify(t))},X=function(){try{var o=JSON.parse(localStorage.getItem("geo-jump-store")||""),e=!1;return Object.entries(G).forEach(function(t){var n=t[0],i=t[1];n in o||(e=!0,o[n]=i)}),e&&Y(o),o}catch(o){return Y(G),t({},G)}}(),U=function(t){return X[t]},B=function(t,o){X[t]=o,Y(X)},W=((F={})[w]={TITLE:"GEO JUMP",HI_PREFIX:"HI: ",START:"START",HELP:"HELP",TOGGLE_LANG:"中文",SCORE_PREFIX:"SCORE: ",CONTINUE:"CONTINUE",BACK:"BACK",HELP_PARAGRAPH:["Click　the　screen　to","emit　bombs　which","explode　while　colliding","with　shapes　and　drive","your　circle　to　move","further.　The　further","your　circle　moves,　the","more　scores　you　get."]},F[C]={TITLE:"几何弹跳",HI_PREFIX:"最高：",START:"开始",HELP:"帮助",TOGGLE_LANG:"ENG",SCORE_PREFIX:"分数：",CONTINUE:"继续",BACK:"返回",HELP_PARAGRAPH:["","　　点击屏幕发射炸弹，","　　炸弹接触方块爆炸，","　　同时推动小球移动。","　　按球前进距离计分，","　　距离越远分数越高。"]},F),M=U(N),V=W[M],j=new HE.Camera,J=r.createScene({background:f,camera:j});J.add(k),m.forEach(function(t){J.add(t)});var K=new e({content:V.SCORE_PREFIX+"???",position:n.of(0,a.top+30),style:{font:"bold 24px Consolas",strokeStyle:null,fillStyle:"#0FC",textBaseline:"top"}});J.attach(K);var z=new e({content:V.HI_PREFIX+"???",position:n.of(0,a.top+60),style:{font:"bold 24px Consolas",strokeStyle:null,fillStyle:"#0CF",textBaseline:"top"}});J.attach(z);var Z=new i({interactive:!0,position:n.of(0,-40),width:120,height:40,radius:6,style:{fillStyle:"#333",strokeStyle:"#999",lineWidth:3,shadowColor:"#000",shadowOffsetY:4},attachments:[new e({content:V.CONTINUE,style:{font:"bold 18px Consolas",strokeStyle:null,fillStyle:"#0FF",shadowColor:"#000",shadowOffsetY:2}})]}).on("click",function(){r.enter($)});J.on("enter",function(){J.fps=60,J.detach(Z),J.effects.forEach(function(t){t instanceof HE.Transition&&t.finish()}),m.forEach(function(t,o){g(t),o?O(o):t.moveTo(0,H())}),k.activate(),k.velocity.reset(),k.moveTo(0,-80),P=0}).on("didUpdate",function(){if(k.bounds.top<a.bottom){var t=k.position.x,o=b(j.position.x=z.position.x=K.position.x=t);K.content=V.SCORE_PREFIX+o,z.content=V.HI_PREFIX+Math.max(U(_),o),k.bounds.left>=m[1].position.x&&(m.push(m.shift()),g(m[2]),O(2))}else if(k.active){k.activate(!1),J.fps=30,Z.moveTo(k.position.x,Z.position.y),J.attach(Z);var e=T();e>U(_)&&B(_,e)}});var q=l.throttle(function(t){var o=n.minus(t,k.position);o.isZero()||L(J,k.position,o)},250);r.pointer.on("click",function(t){J.active&&k.active&&q(t)});var D=a.left+50,Q=r.createScene({background:f,fps:2,attachments:[new e({content:V.HELP,position:n.of(0,a.top+40),style:{font:"bold 40px Consolas",textBaseline:"top",strokeStyle:null,fillStyle:"#F60",shadowColor:"#310",shadowOffsetY:3}}),new HE.Line({start:n.of(D,-120),end:n.of(D,70),style:{strokeStyle:"#0F0",lineWidth:4,shadowColor:"#030",shadowOffsetX:1,shadowOffsetY:2}}),new HE.Paragraph({position:n.of(D+15,-120),lineHeight:25,lines:V.HELP_PARAGRAPH,style:{font:"16px Consolas",strokeStyle:null,fillStyle:"#0CF",textAlign:"left",textBaseline:"top",shadowColor:"#013",shadowOffsetY:2}}),new i({interactive:!0,position:n.of(0,a.bottom-40-20),width:90,height:40,radius:6,style:{strokeStyle:"#999",lineWidth:3,shadowColor:"#111",shadowOffsetY:4},attachments:[new e({content:V.BACK,style:{font:"bold 20px Consolas",strokeStyle:null,fillStyle:"#FC0",shadowColor:"#310",shadowOffsetY:3}})]}).on("click",function(){r.enter($)})]}),$=r.createScene({background:f,fps:50}),tt=s.context.createLinearGradient(0,-25,0,25);tt.addColorStop(0,"#03F"),tt.addColorStop(1,"#90C"),$.attach(new e({content:V.TITLE,position:n.of(0,-130),style:{font:"48px Consolas",fillStyle:"#0FF",strokeStyle:tt,lineWidth:6,lineJoin:"round",shadowColor:"#004",shadowOffsetY:6}}));var ot=new e({content:V.HI_PREFIX+"???",position:n.of(0,-50),style:{font:"bold 25px Consolas",fillStyle:"#0CF",strokeStyle:null,shadowColor:"#003",shadowOffsetY:2}});$.attach(ot).on("enter",function(){ot.content=V.HI_PREFIX+U(_)});var et={lineWidth:3,shadowOffsetY:3},nt={font:"bold 25px Consolas",strokeStyle:null,shadowOffsetY:3},it=0,lt=function(o,l,s){return new i({interactive:!0,position:n.of(0,40+60*it++),width:120,height:40,radius:6,style:t({},et,{strokeStyle:l,shadowColor:s}),attachments:[new e({content:o,style:t({},nt,{fillStyle:l,shadowColor:s})})]})};$.attach(lt(V.START,"#F3C","#613").on("click",function(){r.enter(J)})).attach(lt(V.HELP,"#FC0","#631").on("click",function(){r.enter(Q)}));var st=a.bottom-30;$.attach(new e({content:"by 3h",position:n.of(0,st),style:{font:"bold 20px Consolas",fillStyle:"#0CF",strokeStyle:null,lineJoin:"round",shadowColor:"#024",shadowOffsetY:1}})),$.attach(new i({interactive:!0,position:n.of(a.left+40,st),width:50,height:30,radius:5,style:{strokeStyle:"#666",lineWidth:2,shadowColor:"#000",shadowOffsetY:2},attachments:[new e({content:V.TOGGLE_LANG,style:{font:"bold 12px Consolas",fillStyle:"#999",strokeStyle:null,lineJoin:"round",shadowColor:"#000",shadowOffsetY:2}})]}).on("click",function(){B(N,M===w?C:w),location.reload()}));var rt=a.top+50,at=a.bottom-50,ct=.2*a.bottom;$.on("enter",function(){$.effects.forEach(function(t){t instanceof HE.Transition&&t.finish()})}).on("willUpdate",l.throttle(function(){$.objects.length>=5||R($,n.of(l.random(a.left+50,a.right-50),l.random(rt,at)))},1e3)).on("willUpdate",l.throttle(function(){Math.random()>.5?L($,n.of(a.left-20,l.random(rt,ct)),n.random(0,.8*-l.Const.HALF_PI)):L($,n.of(a.right+20,l.random(rt,ct)),n.random(-Math.PI,1.2*-l.Const.HALF_PI))},1500)),document.title=V.TITLE,r.enter($)}();
